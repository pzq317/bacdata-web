{"ast":null,"code":"import _classCallCheck from \"/Users/pzq317/Desktop/project-bacdata/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/pzq317/Desktop/project-bacdata/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/pzq317/Desktop/project-bacdata/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/pzq317/Desktop/project-bacdata/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/pzq317/Desktop/project-bacdata/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/Users/pzq317/Desktop/project-bacdata/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"/Users/pzq317/Desktop/project-bacdata/src/LineChart.js\";\nimport React, { Component } from 'react';\nimport * as d3 from 'd3';\nimport categoryData from './data/category.csv';\nimport dd from './data/linechartdata.csv';\n\nvar Line =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Line, _Component);\n\n  function Line(props) {\n    var _this;\n\n    _classCallCheck(this, Line);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Line).call(this, props));\n    _this.state = {\n      count: 0,\n      category: [],\n      product: []\n    };\n    _this.upDate = _this.upDate.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.drawChart = _this.drawChart.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.convert = _this.convert.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n\n  _createClass(Line, [{\n    key: \"shouldComponentUpdate\",\n    value: function shouldComponentUpdate(nextProps) {\n      if (this.props.trade !== nextProps.trade || this.props.year !== nextProps.year || this.props.country !== nextProps.country) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      this.setData().then(function (d) {\n        _this2.drawChart(d); //this.drawCategoryChart()\n\n      });\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      var _this3 = this;\n\n      this.setData().then(function (d) {\n        _this3.upDate(d); //this.drawCategoryChart()\n\n      });\n    }\n  }, {\n    key: \"setData\",\n    value: function setData(data) {\n      var _this4 = this;\n\n      return new Promise(function (resolve) {\n        /*d3.csv(categoryData,function(d){\n            var year = this.props.year\n            if(d.Trade == this.props.trade)\n            return {\n                Reporter : d.Reporter,\n                Partner : d.Partner,\n                Product : d.Product,\n                Trade : d.Trade,\n                Value : +d[year],\n                Year: year\n            }\n        }.bind(this)).then(function(category){\n            var flags = [],\n                product = [], \n                l = category.length, \n                i;\n            for( i=0; i<l; i++) {\n                if( flags[category[i].Product]) continue;\n                flags[category[i].Product] = true;\n                product.push(category[i].Product);\n            }\n            product = product.filter(d=> d!='AllProducts')\n            console.log('product',product)\n             this.setState({\n                category: category,\n                product: product\n            })\n            resolve('ture')\n        }.bind(this))*/\n\n        /*d3.csv(dd).then(function (data) {\n             console.log(data)\n            var countries = data.columns.slice(1).map(function(c){\n                return{\n                    country: c,\n                    value : data.map(function(d){\n                        return{\n                            year: +d.Year,\n                            ap: +d[c]\n                        }\n                    })\n                }\n            })\n            console.log(countries)\n            resolve(countries)\n        })*/\n        d3.csv(categoryData).then(function (data) {\n          var _this5 = this;\n\n          //Change partner\n          var dataUS = data.filter(function (d) {\n            return d['Reporter'] != 'China' && d['Partner'] == 'United-States' && d['Trade'] == _this5.props.trade && d['Product'] == 'AllProducts';\n          });\n          var dataCN = data.filter(function (d) {\n            return d['Reporter'] != 'United-States' && d['Partner'] == 'China' && d['Trade'] == _this5.props.trade && d['Product'] == 'AllProducts';\n          });\n          console.log(dataUS, dataCN);\n          dataUS['value'] = [];\n          var countriesUS = dataUS.map(function (d) {\n            d['value'] = [];\n\n            for (var i = 2016; i > 2005; i--) {\n              d['value'].push({\n                year: i.toString(),\n                ap: +d[i.toString()]\n              });\n            }\n\n            return {\n              country: d['Reporter'],\n              value: d['value']\n            };\n          }); //var cc = data.row(function(d) { return {key: d.key}; })\n\n          console.log(countriesUS);\n          resolve(countriesUS);\n        }.bind(_this4));\n      });\n    }\n  }, {\n    key: \"drawChart\",\n    value: function drawChart(countries) {\n      var _this6 = this;\n\n      console.log('draw line', countries);\n      var margin = {\n        top: 10,\n        bottom: 80,\n        left: 80,\n        right: 80\n      };\n      var width = 1000 - margin.left - margin.right;\n      var height = 1000 - margin.top - margin.bottom;\n      var x = d3.scalePoint().range([width, 0]);\n      var y = d3.scaleLinear().range([height, 0]);\n      var z = d3.scaleOrdinal(d3.schemeCategory10);\n      x.domain([2016, 2015, 2014, 2013, 2012, 2011, 2010, 2009, 2008, 2007, 2006]);\n      y.domain([//d3.max(countries,function(d){ return d3.max(d.value,function(e){ return e.ap })}),\n      d3.min(countries, function (d) {\n        return d3.min(d.value, function (e) {\n          return e.ap;\n        });\n      }), d3.max(countries, function (d) {\n        return d3.max(d.value, function (e) {\n          return e.ap;\n        });\n      })]);\n      z.domain(countries.map(function (d) {\n        return d.country;\n      }));\n      var xAxis = d3.axisBottom(x);\n      var yAxis = d3.axisLeft(y);\n      var lineAll = d3.line().curve(d3.curveBasis).x(function (d) {\n        return x(d['year']);\n      }).y(function (d) {\n        return y(d['ap']);\n      });\n      /*var lineCat = d3.line()\n          .x(function(d) { return x(d['year']); })\n          .y(function(d) { return y(d['gdp']); });*/\n\n      var svg = d3.select('#line').append('svg').attr('width', width + margin.left + margin.right).attr('height', height + margin.top + margin.bottom).append('g').attr('id', 'line-svg').attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');\n      svg.append(\"g\").attr(\"class\", \"xAxis\").attr(\"transform\", \"translate(0,\" + height + \")\").call(xAxis).append('text').attr('id', 'text-x').attr(\"transform\", \"translate(\" + width / 2 + \",15)\").attr(\"dy\", \"0.71em\").attr(\"fill\", \"#000\").style(\"text-anchor\", \"middle\").text(\"Years\");\n      svg.append(\"g\").attr(\"class\", \"yAxis\").call(yAxis).selectAll(\"text\").text(function (d) {\n        return _this6.convert(d);\n      });\n      svg.select('.yAxis').append(\"text\").attr('id', 'text-y').attr(\"transform\", \"rotate(-90)\").attr(\"y\", 6).attr(\"dy\", \"0.71em\").attr(\"fill\", \"#000\").text(\"US Dollars\");\n      var country = svg.selectAll('.country').data(countries, function (d) {\n        return d.country;\n      }).enter().append('g').attr('class', 'country');\n      country.append('path').attr('fill', 'none').attr('class', 'line').attr('id', function (d) {\n        return 'line-' + d.country;\n      }).attr('d', function (d) {\n        return lineAll(d.value);\n      }).attr('opacity', 1).attr('stroke-width', 3).style(\"stroke\", function (d) {\n        return z(d.country);\n      }).on('mouseover', function () {\n        d3.select(this).attr('stroke-width', 6);\n      }).on('mouseout', function () {\n        d3.select(this).attr('stroke-width', 3);\n      }); //legend\n\n      /*var g = country.append('g')\n          .attr('id',function(d){ return 'legend'+d.country })\n          .on(\"click\",function(d){\n              //console.log(d3.select('#line-'+d.country).attr('opacity'))\n              if(d3.select('#line-'+d.country).attr('opacity') == '0'){\n                  d3.select('#line-'+d.country).attr('opacity',1)\n              }else if(d3.select('#line-'+d.country).attr('opacity') == '1'){\n                  d3.select('#line-'+d.country).attr('opacity',0)\n              }\n              \n          })\n       g.append('circle')\n          .attr('class','lcircle')\n          .attr('cx',width + margin.right/5)\n          .attr('cy',function(d,i){ return i*(height/15) })\n          .attr('fill', function(d) { return z(d.country); })\n          .attr('r',8)\n       g.append('text')\n          .attr('class','ltext')\n          .attr('x',width + margin.right/4)\n          .attr('y',function(d,i){ return i*(height/15) })\n          .attr(\"fill\", \"#000\")\n          .attr(\"alignment-baseline\",\"middle\")\n          .text(function(d){ return d.country })*/\n    }\n  }, {\n    key: \"upDate\",\n    value: function upDate(countries) {\n      var _this7 = this;\n\n      console.log('update line', countries);\n      countries = countries.filter(function (d) {\n        return d != null;\n      });\n      var margin = {\n        top: 10,\n        bottom: 80,\n        left: 80,\n        right: 80\n      };\n      var width = 1000 - margin.left - margin.right;\n      var height = 1000 - margin.top - margin.bottom;\n      var x = d3.scalePoint().range([width, 0]);\n      var y = d3.scaleLinear().range([height, 0]);\n      var z = d3.scaleOrdinal(d3.schemeCategory10);\n      x.domain([2016, 2015, 2014, 2013, 2012, 2011, 2010, 2009, 2008, 2007, 2006]);\n      y.domain([//d3.max(countries,function(d){ return d3.max(d.value,function(e){ return e.ap })}),\n      d3.min(countries, function (d) {\n        return d3.min(d.value, function (e) {\n          return e.ap;\n        });\n      }), d3.max(countries, function (d) {\n        return d3.max(d.value, function (e) {\n          return e.ap;\n        });\n      })]);\n      z.domain(countries.map(function (d) {\n        return d.country;\n      }));\n      var xAxis = d3.axisBottom(x);\n      var yAxis = d3.axisLeft(y);\n      var lineAll = d3.line().curve(d3.curveBasis).x(function (d) {\n        return x(d['year']);\n      }).y(function (d) {\n        return y(d['ap']);\n      });\n      var svg = d3.select('#line-svg');\n      svg.selectAll('path').data(countries, function (d) {\n        //console.log(d)\n        if (d) {\n          return d.country;\n        }\n      }).transition().duration(1000).attr('d', function (d) {\n        return lineAll(d.value);\n      });\n      svg.select('.yAxis').transition().duration(1000).call(yAxis).selectAll(\"text\").text(function (d) {\n        return _this7.convert(d);\n      });\n    }\n  }, {\n    key: \"convert\",\n    value: function convert(labelValue) {\n      // Nine Zeroes for Billions\n      return Math.abs(Number(labelValue)) >= 1.0e+9 ? Math.round(Math.abs(Number(labelValue)) / 1.0e+9 * 10) / 10 + \"B\" // Six Zeroes for Millions \n      : Math.abs(Number(labelValue)) >= 1.0e+6 ? Math.round(Math.abs(Number(labelValue)) / 1.0e+6 * 10) / 10 + \"M\" // Three Zeroes for Thousands\n      : Math.abs(Number(labelValue)) >= 1.0e+3 ? Math.round(Math.abs(Number(labelValue)) / 1.0e+3 * 10) / 10 + \"K\" : Math.abs(Number(labelValue));\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 316\n        },\n        __self: this\n      }, React.createElement(\"h3\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 317\n        },\n        __self: this\n      }, \"Trade Overview for China, U.S. & the World\"), React.createElement(\"p\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 319\n        },\n        __self: this\n      }, \"A global trade war could hurt consumers around the world by making it harder for all companies to operate,\", React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 319\n        },\n        __self: this\n      }), \" forcing them to push higher prices onto their customers,This project\", React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 319\n        },\n        __self: this\n      }), \"intends to visualize trading value around the world,\"), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 320\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        id: \"lineContainer\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 321\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        id: \"line\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 323\n        },\n        __self: this\n      })));\n    }\n  }]);\n\n  return Line;\n}(Component);\n\nexport { Line as default };","map":{"version":3,"sources":["/Users/pzq317/Desktop/project-bacdata/src/LineChart.js"],"names":["React","Component","d3","categoryData","dd","Line","props","state","count","category","product","upDate","bind","drawChart","convert","nextProps","trade","year","country","setData","then","d","data","Promise","resolve","csv","dataUS","filter","dataCN","console","log","countriesUS","map","i","push","toString","ap","value","countries","margin","top","bottom","left","right","width","height","x","scalePoint","range","y","scaleLinear","z","scaleOrdinal","schemeCategory10","domain","min","e","max","xAxis","axisBottom","yAxis","axisLeft","lineAll","line","curve","curveBasis","svg","select","append","attr","call","style","text","selectAll","enter","on","transition","duration","labelValue","Math","abs","Number","round"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport * as d3 from 'd3'\nimport categoryData from './data/category.csv'\nimport dd from './data/linechartdata.csv'\n\nexport default class Line extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n\t\t\tcount:0,\n            category: [],\n            product: []\n\t\t}\n        this.upDate = this.upDate.bind(this);\n        this.drawChart = this.drawChart.bind(this);\n        this.convert = this.convert.bind(this);\n\t}\n\n    shouldComponentUpdate(nextProps){\n        if(this.props.trade !== nextProps.trade || this.props.year !== nextProps.year || this.props.country !== nextProps.country){\n            return true;\n        }\n        else{\n            return false;\n        }\n    }\n    componentDidMount(){\n        this.setData().then((d)=>{\n            this.drawChart(d)\n            //this.drawCategoryChart()\n        })\n    }\t\n\tcomponentDidUpdate() {\n        this.setData().then((d)=>{\n            this.upDate(d)\n            //this.drawCategoryChart()\n        })\n\t}\n    setData(data) {\n        return new Promise(resolve=>{\n            /*d3.csv(categoryData,function(d){\n                var year = this.props.year\n                if(d.Trade == this.props.trade)\n                return {\n                    Reporter : d.Reporter,\n                    Partner : d.Partner,\n                    Product : d.Product,\n                    Trade : d.Trade,\n                    Value : +d[year],\n                    Year: year\n                }\n            }.bind(this)).then(function(category){\n                var flags = [],\n                    product = [], \n                    l = category.length, \n                    i;\n                for( i=0; i<l; i++) {\n                    if( flags[category[i].Product]) continue;\n                    flags[category[i].Product] = true;\n                    product.push(category[i].Product);\n                }\n                product = product.filter(d=> d!='AllProducts')\n                console.log('product',product)\n\n                this.setState({\n                    category: category,\n                    product: product\n                })\n                resolve('ture')\n            }.bind(this))*/\n            /*d3.csv(dd).then(function (data) {\n\n                console.log(data)\n                var countries = data.columns.slice(1).map(function(c){\n                    return{\n                        country: c,\n                        value : data.map(function(d){\n                            return{\n                                year: +d.Year,\n                                ap: +d[c]\n                            }\n                        })\n                    }\n                })\n                console.log(countries)\n                resolve(countries)\n            })*/\n\n            d3.csv(categoryData).then(function (data) {\n                //Change partner\n                var dataUS = data.filter(d=>d['Reporter']!='China'&&d['Partner']=='United-States'&&d['Trade']==this.props.trade&&d['Product']=='AllProducts')\n                var dataCN = data.filter(d=>d['Reporter']!='United-States'&&d['Partner']=='China'&&d['Trade']==this.props.trade&&d['Product']=='AllProducts')\n                console.log(dataUS,dataCN)\n                dataUS['value'] = []\n                var countriesUS = dataUS.map((d)=>{\n                    d['value'] = []\n                    for(var i=2016;i>2005;i--){\n                        d['value'].push({\n                            year: i.toString(),\n                            ap:+d[i.toString()]\n                        })\n                    }\n                    return ({\n                        country:d['Reporter'],\n                        value: d['value']\n                    })\n                })\n                \n                 \n                //var cc = data.row(function(d) { return {key: d.key}; })\n                console.log(countriesUS)\n                resolve(countriesUS)\n            }.bind(this))\n\n            \n        })\n    }\n\n\tdrawChart(countries) {\n        console.log('draw line',countries)\n        var margin = { top: 10, bottom: 80, left: 80, right: 80 }\n        var width = 1000 - margin.left - margin.right;\n        var height = 1000 - margin.top - margin.bottom;\n\n        var x = d3.scalePoint().range([width, 0])\n        var y = d3.scaleLinear().range([height, 0])\n        var z = d3.scaleOrdinal(d3.schemeCategory10)\n\n        x.domain([2016,2015,2014,2013,2012,2011,2010,2009,2008,2007,2006])\n        y.domain([\n            //d3.max(countries,function(d){ return d3.max(d.value,function(e){ return e.ap })}),\n            d3.min(countries,function(d){ return d3.min(d.value,function(e){ return e.ap })}),\n            d3.max(countries,function(d){ return d3.max(d.value,function(e){ return e.ap })})\n            \n        ])\n\n        z.domain(countries.map(function(d){return d.country}))\n\n        var xAxis = d3.axisBottom(x)\n        var yAxis = d3.axisLeft(y)\n\n        var lineAll = d3.line()\n            .curve(d3.curveBasis)\n            .x(function(d) { return x(d['year']); })\n            .y(function(d) { return y(d['ap']); });\n\n        /*var lineCat = d3.line()\n            .x(function(d) { return x(d['year']); })\n            .y(function(d) { return y(d['gdp']); });*/\n\n        \n\n        var svg = d3.select('#line')\n            .append('svg')\n            .attr('width',width + margin.left + margin.right)\n            .attr('height',height + margin.top + margin.bottom)\n            .append('g')\n            .attr('id','line-svg')\n            .attr('transform','translate(' +margin.left+ ',' +margin.top+ ')')\n\n        svg.append(\"g\")\n            .attr(\"class\", \"xAxis\")\n            .attr(\"transform\", \"translate(0,\" + height + \")\")\n            .call(xAxis)\n            .append('text')\n            .attr('id','text-x')\n            .attr(\"transform\", \"translate(\"+(width/2)+\",15)\")\n            .attr(\"dy\", \"0.71em\")\n            .attr(\"fill\", \"#000\")\n            .style(\"text-anchor\", \"middle\")\n            .text(\"Years\");\n\n        svg.append(\"g\")\n            .attr(\"class\", \"yAxis\")\n            .call(yAxis)\n            .selectAll(\"text\")\n            .text((d)=>{ return this.convert(d) })\n\n        svg.select('.yAxis')\n            .append(\"text\")\n            .attr('id','text-y')\n            .attr(\"transform\", \"rotate(-90)\")\n            .attr(\"y\", 6)\n            .attr(\"dy\", \"0.71em\")\n            .attr(\"fill\", \"#000\")\n            .text(\"US Dollars\");\n\n        var country = svg.selectAll('.country')\n            .data(countries,function(d){ return d.country })\n            .enter()\n            .append('g')\n            .attr('class','country')\n\n        country.append('path')\n            .attr('fill','none')\n            .attr('class','line')\n            .attr('id',function(d){ return 'line-'+d.country })\n            .attr('d',function(d){ return lineAll(d.value)})\n            .attr('opacity',1)\n            .attr('stroke-width',3)\n            .style(\"stroke\", function(d) { return z(d.country); })\n            .on('mouseover',function(){\n                d3.select(this).attr('stroke-width',6);\n            })\n            .on('mouseout',function(){\n                d3.select(this).attr('stroke-width', 3);\n            })\n\n        //legend\n\n        /*var g = country.append('g')\n            .attr('id',function(d){ return 'legend'+d.country })\n            .on(\"click\",function(d){\n                //console.log(d3.select('#line-'+d.country).attr('opacity'))\n                if(d3.select('#line-'+d.country).attr('opacity') == '0'){\n                    d3.select('#line-'+d.country).attr('opacity',1)\n                }else if(d3.select('#line-'+d.country).attr('opacity') == '1'){\n                    d3.select('#line-'+d.country).attr('opacity',0)\n                }\n                \n            })\n\n        g.append('circle')\n            .attr('class','lcircle')\n            .attr('cx',width + margin.right/5)\n            .attr('cy',function(d,i){ return i*(height/15) })\n            .attr('fill', function(d) { return z(d.country); })\n            .attr('r',8)\n\n        g.append('text')\n            .attr('class','ltext')\n            .attr('x',width + margin.right/4)\n            .attr('y',function(d,i){ return i*(height/15) })\n            .attr(\"fill\", \"#000\")\n            .attr(\"alignment-baseline\",\"middle\")\n            .text(function(d){ return d.country })*/\n\n\t}\n\n\tupDate(countries) {\n        console.log('update line',countries)\n        countries = countries.filter(d=>d!=null)\n        var margin = { top: 10, bottom: 80, left: 80, right: 80 }\n        var width = 1000 - margin.left - margin.right;\n        var height = 1000 - margin.top - margin.bottom;\n\n        var x = d3.scalePoint().range([width, 0])\n        var y = d3.scaleLinear().range([height, 0])\n        var z = d3.scaleOrdinal(d3.schemeCategory10)\n\n        x.domain([2016,2015,2014,2013,2012,2011,2010,2009,2008,2007,2006])\n        y.domain([\n            //d3.max(countries,function(d){ return d3.max(d.value,function(e){ return e.ap })}),\n            d3.min(countries,function(d){ return d3.min(d.value,function(e){ return e.ap })}),\n            d3.max(countries,function(d){ return d3.max(d.value,function(e){ return e.ap })})\n            \n        ])\n\n        z.domain(countries.map(function(d){return d.country}))\n\n        var xAxis = d3.axisBottom(x)\n        var yAxis = d3.axisLeft(y)\n\n        var lineAll = d3.line()\n            .curve(d3.curveBasis)\n            .x(function(d) { return x(d['year']); })\n            .y(function(d) { return y(d['ap']); });\n\n        var svg = d3.select('#line-svg')\n        \n        svg.selectAll('path')\n            .data(countries,function(d){\n                //console.log(d)\n                if(d){\n                    return d.country\n                } \n            })\n            .transition()\n            .duration(1000)\n            .attr('d',function(d){ return lineAll(d.value)})\n\n        svg.select('.yAxis')\n            .transition()\n            .duration(1000)\n            .call(yAxis)\n            .selectAll(\"text\")\n            .text((d)=>{ return this.convert(d) })\n\n\n\n\t}\n    convert(labelValue) {\n        // Nine Zeroes for Billions\n        return Math.abs(Number(labelValue)) >= 1.0e+9\n\n        ? Math.round((Math.abs(Number(labelValue)) / 1.0e+9)*10)/10 + \"B\"\n        // Six Zeroes for Millions \n        : Math.abs(Number(labelValue)) >= 1.0e+6\n\n        ? Math.round((Math.abs(Number(labelValue)) / 1.0e+6)*10)/10 + \"M\"\n        // Three Zeroes for Thousands\n        : Math.abs(Number(labelValue)) >= 1.0e+3\n\n        ? Math.round((Math.abs(Number(labelValue)) / 1.0e+3)*10)/10 + \"K\"\n\n        : Math.abs(Number(labelValue));\n\n    }\n\n\n    \n\n\n\trender() {\n\t\treturn (\n            <div>\n                <h3>Trade Overview for China, U.S. & the World</h3>\n                    \n                <p>A global trade war could hurt consumers around the world by making it harder for all companies to operate,<br></br> forcing them to push higher prices onto their customers,This project<br></br>intends to visualize trading value around the world,</p>\n                <br></br>\n                <div id='lineContainer'>\n        \t\t\t\n                    <div id='line'></div>\n                </div>\n            </div>\n\t\t)\n\t}\n\n}"]},"metadata":{},"sourceType":"module"}