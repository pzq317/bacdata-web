{"ast":null,"code":"import _classCallCheck from \"/Users/pzq317/Desktop/project-bacdata/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/pzq317/Desktop/project-bacdata/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/pzq317/Desktop/project-bacdata/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/pzq317/Desktop/project-bacdata/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/pzq317/Desktop/project-bacdata/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/Users/pzq317/Desktop/project-bacdata/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"/Users/pzq317/Desktop/project-bacdata/src/WorldMap.js\";\nimport React, { Component } from 'react';\nimport * as d3 from 'd3';\nimport TimeLine from './TimeLine';\nimport TradeBtn from './TradeBtn';\nimport json from './data/world.json';\nimport csv from './data/world_trade_value.csv';\n\nvar WorldMap =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(WorldMap, _Component);\n\n  function WorldMap(props) {\n    var _this;\n\n    _classCallCheck(this, WorldMap);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(WorldMap).call(this, props));\n    _this.state = {\n      data: {},\n      json: {}\n    };\n    _this.drawChart = _this.drawChart.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.upDate = _this.upDate.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n\n  _createClass(WorldMap, [{\n    key: \"shouldComponentUpdate\",\n    value: function shouldComponentUpdate(nextProps) {\n      if (this.props.trade !== nextProps.trade || this.props.year !== nextProps.year) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      console.log(this.props.year);\n      this.drawChart();\n      window.addEventListener('resize', this.upDate);\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      //console.log(this.drawChart)\n      this.upDate();\n      this.upDateTitle();\n    }\n  }, {\n    key: \"upDateTitle\",\n    value: function upDateTitle() {\n      d3.select('#year').html(this.props.year);\n      d3.select('#trade').html(' ' + this.props.trade);\n    }\n  }, {\n    key: \"drawChart\",\n    value: function drawChart() {\n      d3.csv(csv, function (d) {\n        return {\n          Country: d.Country,\n          Year: +d.Year,\n          Trade: d.Trade,\n          Value: +d.Value\n        };\n      }.bind(this)).then(function (data) {\n        var _this2 = this;\n\n        this.setState({\n          data: data\n        });\n        var margin = {\n          top: 20,\n          left: 0,\n          bottom: 0,\n          right: 0\n        },\n            width = +d3.select('#worldmap').style('width').slice(0, -2) - margin.left - margin.right,\n            height = +d3.select('#worldmap').style('height').slice(0, -2) - margin.top - margin.bottom; //var h = +d3.select('#linechart').style('height').slice(0, -2)\n        //var width = 620 - margin.left - margin.right;\n        //var height = 450 - margin.top - margin.bottom;\n\n        var svg1 = d3.select(\"#worldmap\").append(\"svg\").attr(\"width\", width + margin.left + margin.right).attr(\"height\", height + margin.top + margin.bottom).attr('id', 'worldmap-svg').append('g').attr('id', 'worldmap-g').attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');\n        var scaleData = data.filter(function (d) {\n          return d.Trade == _this2.props.trade && d.Year == _this2.props.year;\n        }); // var colorScale = d3.scaleSequential(d3.interpolateBlues)\n        // .domain([d3.min(scaleData, function (d) { return d[Object.keys(d)[3]] }), d3.max(scaleData, function (d) { return d[Object.keys(d)[3]] })])\n\n        var colorScale = d3.scaleSequential(d3.interpolateYlGnBu).domain([d3.min(scaleData, function (d) {\n          return d[Object.keys(d)[3]];\n        }), d3.max(scaleData, function (d) {\n          return d[Object.keys(d)[3]];\n        })]);\n        var populationById = {};\n        console.log(populationById);\n        data.forEach(function (d) {\n          //populationById[d.Country] = d.Value\n          populationById[d.Year + '_' + d.Country + '_' + d.Trade] = d.Value; // year_value[d.Year] = d.Value\n          // trade_year[d.Trade] = year_value\n        });\n        console.log(populationById);\n        json.features = json.features.filter(function (x) {\n          return x.properties.sovereignt !== 'Antarctica';\n        });\n        console.log(json);\n        json.features.forEach(function (d) {\n          var trade = 'Import';\n\n          for (var i = 2006; i < 2017; i++) {\n            var _year = i.toString();\n\n            d.properties[_year + '_' + trade] = populationById[_year + '_' + d.properties.name + '_' + trade];\n          }\n\n          trade = 'Export';\n\n          for (var i = 2006; i < 2017; i++) {\n            var _year2 = i.toString();\n\n            d.properties[_year2 + '_' + trade] = populationById[_year2 + '_' + d.properties.name + '_' + trade];\n          } //d.properties.value = populationById[d.properties.name]\n\n        });\n        this.setState({\n          json: json\n        });\n        console.log(json);\n        var projection = d3.geoMercator().fitSize([width, height], json); //fit svg size!\n\n        var path = d3.geoPath().projection(projection);\n        var country = svg1.selectAll(\"path\").data(json.features) //data join with features\n        .enter();\n        var div = d3.select(\"body\").append(\"div\").attr(\"class\", \"tooltip\").style(\"opacity\", 0);\n        country.append(\"path\").attr('class', 'country').attr(\"fill\", \"#E5E3E3\") // .attr(\"stroke\", \"#404244\")\n        .attr(\"stroke\", \"grey\").attr(\"stroke-width\", 0.5).attr(\"d\", path) // .attr('id','tooltip')\n        .on(\"mouseover\", function (d) {\n          div.style(\"opacity\", .9).style('z-index', 10);\n          div.html(_this2.props.year + \" \" + d.properties['name'] + \"<br>\" + _this2.props.trade + \" Value:\" + _this2.convert(d.properties[year + '_' + trade]));\n        }).on(\"mousemove\", function () {\n          div.style(\"left\", d3.event.pageX + 10 + \"px\").style(\"top\", d3.event.pageY - 10 + \"px\");\n        }).on(\"mouseout\", function () {\n          div.style(\"opacity\", 0).style('z-index', -10);\n        });\n        console.log(this.props);\n        var year = this.props.year;\n        var trade = this.props.trade;\n        svg1.selectAll('.country').attr('fill', function (d) {\n          return d.properties[year + '_' + trade] ? colorScale(d.properties[year + '_' + trade]) : '#E5E3E3';\n        });\n        var g = svg1.append(\"g\").attr('id', 'legend_group');\n        var unit = Math.min(height * 0.04, width * 0.03);\n        g.append('rect').transition().duration(1000).attr('class', 'legend').attr('x', unit / 2).attr('y', height * 0.7 + 4 * unit).attr('height', unit).attr('width', unit).attr('fill', 'lightyellow');\n        g.append('rect').transition().duration(1000).attr('class', 'legend').attr('x', unit / 2).attr('y', height * 0.7 + 3 * unit).attr('height', unit).attr('width', unit).attr('fill', '#f2ffcc');\n        g.append('rect').transition().duration(1000).attr('class', 'legend').attr('x', unit / 2).attr('y', height * 0.7 + 2 * unit).attr('height', unit).attr('width', unit).attr('fill', 'rgb(147,213,170)');\n        g.append('rect').transition().duration(1000).attr('class', 'legend').attr('x', unit / 2).attr('y', height * 0.7 + 1 * unit).attr('height', unit).attr('width', unit).attr('fill', 'rgb(67,173,180)');\n        g.append('rect').transition().duration(1000).attr('class', 'legend').attr('x', unit / 2).attr('y', height * 0.7 + 0 * unit).attr('height', unit).attr('width', unit).attr('fill', 'rgb(30,114,171)');\n        g.append('text').transition().duration(1000).attr('class', 'legend').attr('x', unit * 1.8).attr('y', height * 0.7 + unit * 4.7).attr('font-size', '12').text('less than $ 10M');\n        g.append('text').transition().duration(1000).attr('class', 'legend').attr('x', unit * 1.8).attr('y', height * 0.7 + unit * 3.7).attr('font-size', '12').text('$ 100M');\n        g.append('text').transition().duration(1000).attr('class', 'legend').attr('x', unit * 1.8).attr('y', height * 0.7 + unit * 2.7).attr('font-size', '12').text('$ 400M');\n        g.append('text').transition().duration(1000).attr('class', 'legend').attr('x', unit * 1.8).attr('y', height * 0.7 + unit * 1.7).attr('font-size', '12').text('$ 800M');\n        g.append('text').transition().duration(1000).attr('class', 'legend').attr('x', unit * 1.8).attr('y', height * 0.7 + unit * 0.7).attr('font-size', '12').text('more than $ 1B');\n      }.bind(this));\n    }\n  }, {\n    key: \"upDate\",\n    value: function upDate() {\n      var _this3 = this;\n\n      var data = this.state.data;\n      var json = this.state.json;\n      var margin = {\n        top: 20,\n        left: 0,\n        bottom: 0,\n        right: 0\n      },\n          width = +d3.select('#worldmap').style('width').slice(0, -2) - margin.left - margin.right,\n          height = +d3.select('#worldmap').style('height').slice(0, -2) - margin.top - margin.bottom;\n      var svg = d3.select('#worldmap-svg').attr(\"width\", width + margin.left + margin.right).attr(\"height\", height + margin.top + margin.bottom);\n      d3.select('#worldmap-g').attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');\n      var trade = this.props.trade;\n      var scaleData = data.filter(function (d) {\n        return d.Trade == trade && d.Year == _this3.props.year;\n      });\n\n      if (trade == 'Export') {\n        var colorScale = d3.scaleSequential(d3.interpolateYlGnBu).domain([d3.min(scaleData, function (d) {\n          return d[Object.keys(d)[3]];\n        }), d3.max(scaleData, function (d) {\n          return d[Object.keys(d)[3]];\n        })]);\n      } else {\n        var colorScale = d3.scaleSequential(d3.interpolateOrRd).domain([d3.min(scaleData, function (d) {\n          return d[Object.keys(d)[3]];\n        }), d3.max(scaleData, function (d) {\n          return d[Object.keys(d)[3]];\n        })]);\n      }\n\n      var year = this.props.year;\n      var projection = d3.geoMercator().fitSize([width, height], json); //fit svg size!\n\n      var path = d3.geoPath().projection(projection);\n      svg.selectAll('.country').attr(\"d\", path).attr('fill', function (d) {\n        return d.properties[year + '_' + trade] ? colorScale(d.properties[year + '_' + trade]) : '#E5E3E3';\n      });\n      var unit = Math.min(height * 0.04, width * 0.03);\n\n      if (trade == 'Export') {\n        var g = d3.select('#legend_group');\n        g.selectAll('*').remove();\n        g.append('rect').transition().duration(1000).attr('class', 'legend').attr('x', unit / 2).attr('y', height * 0.7 + 4 * unit).attr('height', unit).attr('width', unit).attr('fill', 'lightyellow');\n        g.append('rect').transition().duration(1000).attr('class', 'legend').attr('x', unit / 2).attr('y', height * 0.7 + 3 * unit).attr('height', unit).attr('width', unit).attr('fill', '#f2ffcc');\n        g.append('rect').transition().duration(1000).attr('class', 'legend').attr('x', unit / 2).attr('y', height * 0.7 + 2 * unit).attr('height', unit).attr('width', unit).attr('fill', 'rgb(147,213,170)');\n        g.append('rect').transition().duration(1000).attr('class', 'legend').attr('x', unit / 2).attr('y', height * 0.7 + 1 * unit).attr('height', unit).attr('width', unit).attr('fill', 'rgb(67,173,180)');\n        g.append('rect').transition().duration(1000).attr('class', 'legend').attr('x', unit / 2).attr('y', height * 0.7 + 0 * unit).attr('height', unit).attr('width', unit).attr('fill', 'rgb(30,114,171)');\n        g.append('text').transition().duration(1000).attr('class', 'legend').attr('x', unit * 1.8).attr('y', height * 0.7 + unit * 4.7).attr('font-size', '12').text('less than $ 10M');\n        g.append('text').transition().duration(1000).attr('class', 'legend').attr('x', unit * 1.8).attr('y', height * 0.7 + unit * 3.7).attr('font-size', '12').text('$ 100M');\n        g.append('text').transition().duration(1000).attr('class', 'legend').attr('x', unit * 1.8).attr('y', height * 0.7 + unit * 2.7).attr('font-size', '12').text('$ 400M');\n        g.append('text').transition().duration(1000).attr('class', 'legend').attr('x', unit * 1.8).attr('y', height * 0.7 + unit * 1.7).attr('font-size', '12').text('$ 800M');\n        g.append('text').transition().duration(1000).attr('class', 'legend').attr('x', unit * 1.8).attr('y', height * 0.7 + unit * 0.7).attr('font-size', '12').text('more than $ 1B');\n      } else {\n        var g = d3.select('#legend_group');\n        g.selectAll('*').remove();\n        g.append('rect').transition().duration(1000).attr('class', 'legend').attr('x', unit / 2).attr('y', height * 0.7 + 4 * unit).attr('height', unit).attr('width', unit).attr('fill', 'rgb(255,243,226)');\n        g.append('rect').transition().duration(1000).attr('class', 'legend').attr('x', unit / 2).attr('y', height * 0.7 + 3 * unit).attr('height', unit).attr('width', unit).attr('fill', 'rgb(253,232,200)');\n        g.append('rect').transition().duration(1000).attr('class', 'legend').attr('x', unit / 2).attr('y', height * 0.7 + 2 * unit).attr('height', unit).attr('width', unit).attr('fill', 'rgb(252,205,149)');\n        g.append('rect').transition().duration(1000).attr('class', 'legend').attr('x', unit / 2).attr('y', height * 0.7 + 1 * unit).attr('height', unit).attr('width', unit).attr('fill', 'rgb(241,102,66)');\n        g.append('rect').transition().duration(1000).attr('class', 'legend').attr('x', unit / 2).attr('y', height * 0.7 + 0 * unit).attr('height', unit).attr('width', unit).attr('fill', 'rgb(106,0,2)');\n        g.append('text').transition().duration(1000).attr('class', 'legend').attr('x', unit * 1.8).attr('y', height * 0.7 + unit * 4.7).attr('font-size', '12').text('less than $ 10M');\n        g.append('text').transition().duration(1000).attr('class', 'legend').attr('x', unit * 1.8).attr('y', height * 0.7 + unit * 3.7).attr('font-size', '12').text('$ 100M');\n        g.append('text').transition().duration(1000).attr('class', 'legend').attr('x', unit * 1.8).attr('y', height * 0.7 + unit * 2.7).attr('font-size', '12').text('$ 400M');\n        g.append('text').transition().duration(1000).attr('class', 'legend').attr('x', unit * 1.8).attr('y', height * 0.7 + unit * 1.7).attr('font-size', '12').text('$ 800M');\n        g.append('text').transition().duration(1000).attr('class', 'legend').attr('x', unit * 1.8).attr('y', height * 0.7 + unit * 0.7).attr('font-size', '12').text('more than $ 1B');\n        /*g.append('rect')\n        \t.transition()\n        \t.duration(1000)\n        \t.attr('class', 'legend')\n        \t.attr('x', 10)\n        \t.attr('y', 375)\n        \t.attr('height', '20')\n        \t.attr('width', '20')\n        \t.attr('fill', 'rgb(255,243,226)')\n        \tg.append('rect')\n        \t.transition()\n        \t.duration(1000)\n        \t.attr('class', 'legend')\n        \t.attr('x', 10)\n        \t.attr('y', 355)\n        \t.attr('height', '20')\n        \t.attr('width', '20')\n        \t.attr('fill', 'rgb(253,232,200)')\n        \tg.append('rect')\n        \t.transition()\n        \t.duration(1000)\n        \t.attr('class', 'legend')\n        \t.attr('x', 10)\n        \t.attr('y', 335)\n        \t.attr('height', '20')\n        \t.attr('width', '20')\n        \t.attr('fill', 'rgb(252,205,149)')\n        \tg.append('rect')\n        \t.transition()\n        \t.duration(1000)\n        \t.attr('class', 'legend')\n        \t.attr('x', 10)\n        \t.attr('y', 315)\n        \t.attr('height', '20')\n        \t.attr('width', '20')\n        \t.attr('fill', 'rgb(241,102,66)')\n        \tg.append('rect')\n        \t.transition()\n        \t.duration(1000)\n        \t.attr('class', 'legend')\n        \t.attr('x', 10)\n        \t.attr('y', 295)\n        \t.attr('height', '20')\n        \t.attr('width', '20')\n        \t.attr('fill', 'rgb(106,0,2)')\n        \tg.append('text')\n        \t.transition()\n        \t.duration(1000)\n        \t.attr('x', 40)\n        \t.attr('y', 392)\n        \t.attr('font-size', '12')\n        \t.text('less than $ 1M')\n        g.append('text')\n        \t.transition()\n        \t.duration(1000)\n        \t.attr('x', 40)\n        \t.attr('y', 370)\n        \t.attr('font-size', '12')\n        \t.text('$ 200M')\n        g.append('text')\n        \t.transition()\n        \t.duration(1000)\n        \t.attr('x', 40)\n        \t.attr('y', 350)\n        \t.attr('font-size', '12')\n        \t.text('$ 500M')\n        \tg.append('text')\n        \t.transition()\n        \t.duration(1000)\n        \t.attr('x', 40)\n        \t.attr('y', 330)\n        \t.attr('font-size', '12')\n        \t.text('$ 1B')\n        \tg.append('text')\n        \t.transition()\n        \t.duration(1000)\n        \t.attr('x', 40)\n        \t.attr('y', 309)\n        \t.attr('font-size', '12')\n        \t.text('more than $ 1B')*/\n      }\n    }\n  }, {\n    key: \"convert\",\n    value: function convert(labelValue) {\n      // Nine Zeroes for Billions\n      return Math.abs(Number(labelValue)) >= 1.0e+9 ? Math.round(Math.abs(Number(labelValue)) / 1.0e+9 * 10) / 10 + \"B\" // Six Zeroes for Millions \n      : Math.abs(Number(labelValue)) >= 1.0e+6 ? Math.round(Math.abs(Number(labelValue)) / 1.0e+6 * 10) / 10 + \"M\" // Three Zeroes for Thousands\n      : Math.abs(Number(labelValue)) >= 1.0e+3 ? Math.round(Math.abs(Number(labelValue)) / 1.0e+3 * 10) / 10 + \"K\" : Math.abs(Number(labelValue));\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(\"div\", {\n        id: \"worldmap\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 607\n        },\n        __self: this\n      });\n    }\n  }]);\n\n  return WorldMap;\n}(Component);\n\nexport { WorldMap as default };","map":{"version":3,"sources":["/Users/pzq317/Desktop/project-bacdata/src/WorldMap.js"],"names":["React","Component","d3","TimeLine","TradeBtn","json","csv","WorldMap","props","state","data","drawChart","bind","upDate","nextProps","trade","year","console","log","window","addEventListener","upDateTitle","select","html","d","Country","Year","Trade","Value","then","setState","margin","top","left","bottom","right","width","style","slice","height","svg1","append","attr","scaleData","filter","colorScale","scaleSequential","interpolateYlGnBu","domain","min","Object","keys","max","populationById","forEach","features","x","properties","sovereignt","i","toString","name","projection","geoMercator","fitSize","path","geoPath","country","selectAll","enter","div","on","convert","event","pageX","pageY","g","unit","Math","transition","duration","text","svg","interpolateOrRd","remove","labelValue","abs","Number","round"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport * as d3 from 'd3'\nimport TimeLine from './TimeLine'\nimport TradeBtn from './TradeBtn'\nimport json from './data/world.json'\nimport csv from './data/world_trade_value.csv'\n\nexport default class WorldMap extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n\t\t\tdata: {},\n\t\t\tjson:{}\n\t\t}\n\t\tthis.drawChart = this.drawChart.bind(this);\n\t\tthis.upDate = this.upDate.bind(this);\n\t}\n\n\tshouldComponentUpdate(nextProps) {\n\t\tif (this.props.trade !== nextProps.trade || this.props.year !== nextProps.year) {\n\t\t\treturn true;\n\t\t}\n\t\telse {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tcomponentDidMount() {\n\t\tconsole.log(this.props.year)\n\t\tthis.drawChart();\n\t\twindow.addEventListener('resize', this.upDate)\n\t}\n\tcomponentDidUpdate() {\n\t\t//console.log(this.drawChart)\n\t\tthis.upDate();\n\t\tthis.upDateTitle();\n\t}\n\tupDateTitle(){\n\t\td3.select('#year').html(this.props.year)\n\t\td3.select('#trade').html( ' '+this.props.trade)\n\n\n\t}\n\n\tdrawChart() {\n\n\t\td3.csv(csv, function (d) {\n\t\t\treturn {\n\t\t\t\tCountry: d.Country,\n\t\t\t\tYear: +d.Year,\n\t\t\t\tTrade: d.Trade,\n\t\t\t\tValue: +d.Value\n\n\t\t\t}\n\t\t}.bind(this)).then(function (data) {\n\t\t\tthis.setState({\n\t\t\t\tdata: data\n\t\t\t})\n\n\t\t\tvar margin = { top: 20, left: 0, bottom: 0, right: 0 },\n\t\t\t\twidth = +d3.select('#worldmap').style('width').slice(0, -2) - margin.left - margin.right,\n            \theight = +d3.select('#worldmap').style('height').slice(0, -2) - margin.top - margin.bottom;\n        \n\t\t\t//var h = +d3.select('#linechart').style('height').slice(0, -2)\n\t\t\t//var width = 620 - margin.left - margin.right;\n\t\t\t//var height = 450 - margin.top - margin.bottom;\n\n\n\t\t\tvar svg1 = d3.select(\"#worldmap\").append(\"svg\")\n\t\t\t\t.attr(\"width\", width + margin.left + margin.right)\n\t\t\t\t.attr(\"height\", height + margin.top + margin.bottom)\n\t\t\t\t.attr('id','worldmap-svg')\n\t\t\t\t.append('g')\n\t\t\t\t.attr('id', 'worldmap-g')\n\t\t\t\t.attr('transform', 'translate(' + margin.left + ',' + margin.top + ')')\n\n\t\t\tvar scaleData = data.filter(d => d.Trade == this.props.trade && d.Year == this.props.year);\n\n\t\t\t// var colorScale = d3.scaleSequential(d3.interpolateBlues)\n\t\t\t// .domain([d3.min(scaleData, function (d) { return d[Object.keys(d)[3]] }), d3.max(scaleData, function (d) { return d[Object.keys(d)[3]] })])\n\n\t\t\tvar colorScale = d3.scaleSequential(d3.interpolateYlGnBu)\n\t\t\t\t.domain([d3.min(scaleData, function (d) { return d[Object.keys(d)[3]] }), d3.max(scaleData, function (d) { return d[Object.keys(d)[3]] })])\n\n\t\t\tvar populationById = {};\n\t\t\tconsole.log(populationById)\n\t\t\tdata.forEach(function (d) {\n\t\t\t\t//populationById[d.Country] = d.Value\n\t\t\t\tpopulationById[d.Year + '_' + d.Country + '_' + d.Trade] = d.Value\n\t\t\t\t// year_value[d.Year] = d.Value\n\t\t\t\t// trade_year[d.Trade] = year_value\n\t\t\t})\n\t\t\tconsole.log(populationById)\n\t\t\tjson.features = json.features.filter(x => x.properties.sovereignt !== 'Antarctica')\n\n\t\t\tconsole.log(json)\n\n\t\t\tjson.features.forEach(function (d) {\n\t\t\t\tvar trade = 'Import'\n\t\t\t\tfor (var i = 2006; i < 2017; i++) {\n\t\t\t\t\tlet year = i.toString()\n\t\t\t\t\td.properties[year + '_' + trade] = populationById[year + '_' + d.properties.name + '_' + trade]\n\t\t\t\t}\n\n\t\t\t\ttrade = 'Export'\n\t\t\t\tfor (var i = 2006; i < 2017; i++) {\n\t\t\t\t\tlet year = i.toString()\n\t\t\t\t\td.properties[year + '_' + trade] = populationById[year + '_' + d.properties.name + '_' + trade]\n\t\t\t\t}\n\t\t\t\t//d.properties.value = populationById[d.properties.name]\n\n\t\t\t})\n\n\t\t\tthis.setState({\n\t\t\t\tjson:json\n\t\t\t})\n\t\t\tconsole.log(json)\n\n\t\t\tvar projection = d3.geoMercator()\n\t\t\t\t.fitSize([width, height], json); //fit svg size!\n\n\t\t\tvar path = d3.geoPath()\n\t\t\t\t.projection(projection);\n\n\t\t\tvar country = svg1.selectAll(\"path\")\n\t\t\t\t.data(json.features) //data join with features\n\t\t\t\t.enter()\n\n\t\t\tvar div = d3.select(\"body\").append(\"div\")\n\t\t\t\t.attr(\"class\", \"tooltip\")\n\t\t\t\t.style(\"opacity\", 0);\n\n\t\t\tcountry.append(\"path\")\n\t\t\t\t.attr('class', 'country')\n\t\t\t\t.attr(\"fill\", \"#E5E3E3\")\n\t\t\t\t// .attr(\"stroke\", \"#404244\")\n\t\t\t\t.attr(\"stroke\", \"grey\")\n\t\t\t\t.attr(\"stroke-width\", 0.5)\n\t\t\t\t.attr(\"d\", path)\n\t\t\t\t// .attr('id','tooltip')\n\t\t\t\t.on(\"mouseover\", (d) => {\n\t\t\t\t\tdiv.style(\"opacity\", .9)\n\t\t\t\t\t\t.style('z-index',10)\n\n\t\t\t\t\tdiv.html(this.props.year + \" \" + d.properties['name'] + \"<br>\"  + this.props.trade + \" Value:\" + this.convert(d.properties[year + '_' + trade]))\t\n\t\t\t\t})\n\t\t\t\t.on(\"mousemove\", function () {\n\t\t\t\t\tdiv.style(\"left\", (d3.event.pageX + 10) + \"px\")\n\t\t\t\t\t\t.style(\"top\", (d3.event.pageY - 10) + \"px\")\n\t\t\t\t})\n\t\t\t\t.on(\"mouseout\", function () {\n\t\t\t\t\tdiv.style(\"opacity\", 0)\n\t\t\t\t\t\t.style('z-index',-10)\n\t\t\t\t});\n\n\t\t\tconsole.log(this.props)\n\t\t\tvar year = this.props.year\n\t\t\tvar trade = this.props.trade\n\t\t\tsvg1.selectAll('.country')\n\t\t\t\t.attr('fill', function (d) { return d.properties[year + '_' + trade] ? colorScale(d.properties[year + '_' + trade]) : '#E5E3E3' })\n\n\t\t\tvar g = svg1.append(\"g\").attr('id', 'legend_group')\n\n\t\t\tvar unit = Math.min(height *0.04,width*0.03)\n\n\t\t\tg.append('rect')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', unit/2)\n\t\t\t\t.attr('y', height*0.7 + 4*unit)\n\t\t\t\t.attr('height', unit)\n\t\t\t\t.attr('width', unit)\n\t\t\t\t.attr('fill', 'lightyellow')\n\n\t\t\tg.append('rect')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', unit/2)\n\t\t\t\t.attr('y', height*0.7 + 3*unit)\n\t\t\t\t.attr('height', unit)\n\t\t\t\t.attr('width', unit)\n\t\t\t\t.attr('fill', '#f2ffcc')\n\n\t\t\tg.append('rect')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', unit/2)\n\t\t\t\t.attr('y', height*0.7 + 2*unit)\n\t\t\t\t.attr('height', unit)\n\t\t\t\t.attr('width', unit)\n\t\t\t\t.attr('fill', 'rgb(147,213,170)')\n\n\t\t\tg.append('rect')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', unit/2)\n\t\t\t\t.attr('y', height*0.7 + 1*unit)\n\t\t\t\t.attr('height', unit)\n\t\t\t\t.attr('width', unit)\n\t\t\t\t.attr('fill', 'rgb(67,173,180)')\n\n\t\t\tg.append('rect')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', unit/2)\n\t\t\t\t.attr('y', height*0.7 + 0*unit)\n\t\t\t\t.attr('height', unit)\n\t\t\t\t.attr('width', unit)\n\t\t\t\t.attr('fill', 'rgb(30,114,171)')\n\n\t\t\tg.append('text')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', unit*1.8)\n\t\t\t\t.attr('y', height*0.7 + unit*4.7)\n\t\t\t\t.attr('font-size', '12')\n\t\t\t\t.text('less than $ 10M')\n\t\t\tg.append('text')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', unit*1.8)\n\t\t\t\t.attr('y', height*0.7 + unit*3.7)\n\t\t\t\t.attr('font-size', '12')\n\t\t\t\t.text('$ 100M')\n\t\t\tg.append('text')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', unit*1.8)\n\t\t\t\t.attr('y', height*0.7 + unit*2.7)\n\t\t\t\t.attr('font-size', '12')\n\t\t\t\t.text('$ 400M')\n\n\t\t\tg.append('text')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', unit*1.8)\n\t\t\t\t.attr('y', height*0.7 + unit*1.7)\n\t\t\t\t.attr('font-size', '12')\n\t\t\t\t.text('$ 800M')\n\t\t\t\t\n\t\t\tg.append('text')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', unit*1.8)\n\t\t\t\t.attr('y', height*0.7 + unit*0.7)\n\t\t\t\t.attr('font-size', '12')\n\t\t\t\t.text('more than $ 1B')\n\n\t\t}.bind(this))\n\t\t\n\t}\n\n\tupDate() {\n\n\t\tvar data = this.state.data\n\t\tvar json = this.state.json\n\t\tvar margin = { top: 20, left: 0, bottom: 0, right: 0 },\n\t\t\t\twidth = +d3.select('#worldmap').style('width').slice(0, -2) - margin.left - margin.right,\n            \theight = +d3.select('#worldmap').style('height').slice(0, -2) - margin.top - margin.bottom;\n        \n\t\tvar svg = d3.select('#worldmap-svg')\n\t\t\t\t\t.attr(\"width\", width + margin.left + margin.right)\n\t\t\t\t\t.attr(\"height\", height + margin.top + margin.bottom)\n\n\t\td3.select('#worldmap-g')\n\t\t\t.attr('transform', 'translate(' + margin.left + ',' + margin.top + ')')\n\n\t\tvar trade = this.props.trade\n\t\tvar scaleData = data.filter(d => d.Trade == trade && d.Year == this.props.year)\n\n\t\tif (trade == 'Export') {\n\t\t\tvar colorScale = d3.scaleSequential(d3.interpolateYlGnBu)\n\t\t\t\t.domain([d3.min(scaleData, function (d) { return d[Object.keys(d)[3]] }), d3.max(scaleData, function (d) { return d[Object.keys(d)[3]] })])\n\t\t}\n\t\telse {\n\t\t\tvar colorScale = d3.scaleSequential(d3.interpolateOrRd)\n\t\t\t\t.domain([d3.min(scaleData, function (d) { return d[Object.keys(d)[3]] }), d3.max(scaleData, function (d) { return d[Object.keys(d)[3]] })])\n\t\t\t\n\t\t\t}\n\t\tvar year = this.props.year\n\n\t\tvar projection = d3.geoMercator()\n\t\t\t\t.fitSize([width, height], json); //fit svg size!\n\n\t\tvar path = d3.geoPath()\n\t\t\t.projection(projection);\n\n\t\tsvg.selectAll('.country')\n\t\t\t.attr(\"d\", path)\n\t\t\t.attr('fill', function (d) { return d.properties[year + '_' + trade] ? colorScale(d.properties[year + '_' + trade]) : '#E5E3E3' })\n\n\t\tvar unit = Math.min(height *0.04,width*0.03)\n\n\t\tif (trade == 'Export') {\n\t\t\tvar g = d3.select('#legend_group');\n\t\t\tg.selectAll('*').remove();\n\t\t\tg.append('rect')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', unit/2)\n\t\t\t\t.attr('y', height*0.7 + 4*unit)\n\t\t\t\t.attr('height', unit)\n\t\t\t\t.attr('width', unit)\n\t\t\t\t.attr('fill', 'lightyellow')\n\n\t\t\tg.append('rect')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', unit/2)\n\t\t\t\t.attr('y', height*0.7 + 3*unit)\n\t\t\t\t.attr('height', unit)\n\t\t\t\t.attr('width', unit)\n\t\t\t\t.attr('fill', '#f2ffcc')\n\n\t\t\tg.append('rect')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', unit/2)\n\t\t\t\t.attr('y', height*0.7 + 2*unit)\n\t\t\t\t.attr('height', unit)\n\t\t\t\t.attr('width', unit)\n\t\t\t\t.attr('fill', 'rgb(147,213,170)')\n\n\t\t\tg.append('rect')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', unit/2)\n\t\t\t\t.attr('y', height*0.7 + 1*unit)\n\t\t\t\t.attr('height', unit)\n\t\t\t\t.attr('width', unit)\n\t\t\t\t.attr('fill', 'rgb(67,173,180)')\n\n\t\t\tg.append('rect')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', unit/2)\n\t\t\t\t.attr('y', height*0.7 + 0*unit)\n\t\t\t\t.attr('height', unit)\n\t\t\t\t.attr('width', unit)\n\t\t\t\t.attr('fill', 'rgb(30,114,171)')\n\n\t\t\tg.append('text')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', unit*1.8)\n\t\t\t\t.attr('y', height*0.7 + unit*4.7)\n\t\t\t\t.attr('font-size', '12')\n\t\t\t\t.text('less than $ 10M')\n\t\t\tg.append('text')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', unit*1.8)\n\t\t\t\t.attr('y', height*0.7 + unit*3.7)\n\t\t\t\t.attr('font-size', '12')\n\t\t\t\t.text('$ 100M')\n\t\t\tg.append('text')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', unit*1.8)\n\t\t\t\t.attr('y', height*0.7 + unit*2.7)\n\t\t\t\t.attr('font-size', '12')\n\t\t\t\t.text('$ 400M')\n\n\t\t\tg.append('text')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', unit*1.8)\n\t\t\t\t.attr('y', height*0.7 + unit*1.7)\n\t\t\t\t.attr('font-size', '12')\n\t\t\t\t.text('$ 800M')\n\t\t\t\t\n\t\t\tg.append('text')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', unit*1.8)\n\t\t\t\t.attr('y', height*0.7 + unit*0.7)\n\t\t\t\t.attr('font-size', '12')\n\t\t\t\t.text('more than $ 1B')\n\t\t}\n\t\telse {\n\t\t\tvar g = d3.select('#legend_group');\n\t\t\tg.selectAll('*').remove();\n\t\t\tg.append('rect')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', unit/2)\n\t\t\t\t.attr('y', height*0.7 + 4*unit)\n\t\t\t\t.attr('height', unit)\n\t\t\t\t.attr('width', unit)\n\t\t\t\t.attr('fill', 'rgb(255,243,226)')\n\n\t\t\tg.append('rect')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', unit/2)\n\t\t\t\t.attr('y', height*0.7 + 3*unit)\n\t\t\t\t.attr('height', unit)\n\t\t\t\t.attr('width', unit)\n\t\t\t\t.attr('fill', 'rgb(253,232,200)')\n\n\t\t\tg.append('rect')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', unit/2)\n\t\t\t\t.attr('y', height*0.7 + 2*unit)\n\t\t\t\t.attr('height', unit)\n\t\t\t\t.attr('width', unit)\n\t\t\t\t.attr('fill', 'rgb(252,205,149)')\n\n\t\t\tg.append('rect')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', unit/2)\n\t\t\t\t.attr('y', height*0.7 + 1*unit)\n\t\t\t\t.attr('height', unit)\n\t\t\t\t.attr('width', unit)\n\t\t\t\t.attr('fill', 'rgb(241,102,66)')\n\n\t\t\tg.append('rect')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', unit/2)\n\t\t\t\t.attr('y', height*0.7 + 0*unit)\n\t\t\t\t.attr('height', unit)\n\t\t\t\t.attr('width', unit)\n\t\t\t\t.attr('fill', 'rgb(106,0,2)')\n\n\t\t\tg.append('text')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', unit*1.8)\n\t\t\t\t.attr('y', height*0.7 + unit*4.7)\n\t\t\t\t.attr('font-size', '12')\n\t\t\t\t.text('less than $ 10M')\n\t\t\tg.append('text')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', unit*1.8)\n\t\t\t\t.attr('y', height*0.7 + unit*3.7)\n\t\t\t\t.attr('font-size', '12')\n\t\t\t\t.text('$ 100M')\n\t\t\tg.append('text')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', unit*1.8)\n\t\t\t\t.attr('y', height*0.7 + unit*2.7)\n\t\t\t\t.attr('font-size', '12')\n\t\t\t\t.text('$ 400M')\n\n\t\t\tg.append('text')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', unit*1.8)\n\t\t\t\t.attr('y', height*0.7 + unit*1.7)\n\t\t\t\t.attr('font-size', '12')\n\t\t\t\t.text('$ 800M')\n\t\t\t\t\n\t\t\tg.append('text')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', unit*1.8)\n\t\t\t\t.attr('y', height*0.7 + unit*0.7)\n\t\t\t\t.attr('font-size', '12')\n\t\t\t\t.text('more than $ 1B')\n\t\t\t\n\t\t\t/*g.append('rect')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', 10)\n\t\t\t\t.attr('y', 375)\n\t\t\t\t.attr('height', '20')\n\t\t\t\t.attr('width', '20')\n\t\t\t\t.attr('fill', 'rgb(255,243,226)')\n\n\t\t\tg.append('rect')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', 10)\n\t\t\t\t.attr('y', 355)\n\t\t\t\t.attr('height', '20')\n\t\t\t\t.attr('width', '20')\n\t\t\t\t.attr('fill', 'rgb(253,232,200)')\n\n\t\t\tg.append('rect')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', 10)\n\t\t\t\t.attr('y', 335)\n\t\t\t\t.attr('height', '20')\n\t\t\t\t.attr('width', '20')\n\t\t\t\t.attr('fill', 'rgb(252,205,149)')\n\n\t\t\tg.append('rect')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', 10)\n\t\t\t\t.attr('y', 315)\n\t\t\t\t.attr('height', '20')\n\t\t\t\t.attr('width', '20')\n\t\t\t\t.attr('fill', 'rgb(241,102,66)')\n\n\t\t\tg.append('rect')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('class', 'legend')\n\t\t\t\t.attr('x', 10)\n\t\t\t\t.attr('y', 295)\n\t\t\t\t.attr('height', '20')\n\t\t\t\t.attr('width', '20')\n\t\t\t\t.attr('fill', 'rgb(106,0,2)')\n\n\t\t\tg.append('text')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('x', 40)\n\t\t\t\t.attr('y', 392)\n\t\t\t\t.attr('font-size', '12')\n\t\t\t\t.text('less than $ 1M')\n\t\t\tg.append('text')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('x', 40)\n\t\t\t\t.attr('y', 370)\n\t\t\t\t.attr('font-size', '12')\n\t\t\t\t.text('$ 200M')\n\t\t\tg.append('text')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('x', 40)\n\t\t\t\t.attr('y', 350)\n\t\t\t\t.attr('font-size', '12')\n\t\t\t\t.text('$ 500M')\n\n\t\t\tg.append('text')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('x', 40)\n\t\t\t\t.attr('y', 330)\n\t\t\t\t.attr('font-size', '12')\n\t\t\t\t.text('$ 1B')\n\n\t\t\tg.append('text')\n\t\t\t\t.transition()\n\t\t\t\t.duration(1000)\n\t\t\t\t.attr('x', 40)\n\t\t\t\t.attr('y', 309)\n\t\t\t\t.attr('font-size', '12')\n\t\t\t\t.text('more than $ 1B')*/\n\t\t}\n\n\t}\n\tconvert(labelValue) {\n\n\t\t// Nine Zeroes for Billions\n\t\treturn Math.abs(Number(labelValue)) >= 1.0e+9\n\n\t\t\t? Math.round((Math.abs(Number(labelValue)) / 1.0e+9) * 10) / 10 + \"B\"\n\t\t\t// Six Zeroes for Millions \n\t\t\t: Math.abs(Number(labelValue)) >= 1.0e+6\n\n\t\t\t? Math.round((Math.abs(Number(labelValue)) / 1.0e+6) * 10) / 10 + \"M\"\n\t\t\t// Three Zeroes for Thousands\n\t\t\t: Math.abs(Number(labelValue)) >= 1.0e+3\n\n\t\t\t? Math.round((Math.abs(Number(labelValue)) / 1.0e+3) * 10) / 10 + \"K\"\n\n\t\t\t: Math.abs(Number(labelValue));\n\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<div id='worldmap'>\n\t\t\t\t\n\t\t\t\t{/*<h6 id='sub-title1'>siuhglsdfjjlf lrguhalsj gklaghjsjklf</h6>*/}\n\t\t\t\t{/*<h6 id='sub-title2'>fgskdjfgnlsdkfjng gsldkjfng</h6>*/}\n\n\t\t\t\t\n\t\t\t</div>\n\n\n\n\t\t)\n\t}\n\n}"]},"metadata":{},"sourceType":"module"}