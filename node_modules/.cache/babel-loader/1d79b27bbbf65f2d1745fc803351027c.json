{"ast":null,"code":"import _classCallCheck from \"/Users/pzq317/Desktop/bacdata-web/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/pzq317/Desktop/bacdata-web/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/pzq317/Desktop/bacdata-web/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/pzq317/Desktop/bacdata-web/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/pzq317/Desktop/bacdata-web/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/Users/pzq317/Desktop/bacdata-web/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"/Users/pzq317/Desktop/bacdata-web/src/PieChart.js\";\nimport React, { Component } from 'react';\nimport * as d3 from 'd3';\nimport categoryData from './data/category.csv';\n\nvar Pie =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Pie, _Component);\n\n  function Pie(props) {\n    var _this;\n\n    _classCallCheck(this, Pie);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Pie).call(this, props));\n    _this.state = {\n      count: 0,\n      category: []\n    };\n    _this.upDate = _this.upDate.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.drawChart = _this.drawChart.bind(_assertThisInitialized(_assertThisInitialized(_this))); //this.drawCategoryChart = this.drawCategoryChart.bind(this);\n\n    _this.convert = _this.convert.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n\n  _createClass(Pie, [{\n    key: \"shouldComponentUpdate\",\n    value: function shouldComponentUpdate(nextProps) {\n      if (this.props.trade !== nextProps.trade || this.props.year !== nextProps.year || this.props.country !== nextProps.country) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      this.setData().then(function () {\n        _this2.drawChart(); //this.drawCategoryChart()\n\n      });\n      window.addEventListener('resize', this.upDate);\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      var _this3 = this;\n\n      this.setData().then(function () {\n        _this3.upDate(); //this.drawCategoryChart()\n\n      });\n    }\n  }, {\n    key: \"setData\",\n    value: function setData(data) {\n      var _this4 = this;\n\n      return new Promise(function (resolve) {\n        d3.csv(categoryData, function (d) {\n          var year = this.props.year;\n          if (d.Trade == this.props.trade) return {\n            Reporter: d.Reporter,\n            Partner: d.Partner,\n            Product: d.Product,\n            Trade: d.Trade,\n            Value: +d[year],\n            Year: year\n          };\n        }.bind(_this4)).then(function (category) {\n          this.setState({\n            category: category\n          });\n          resolve('ture');\n        }.bind(_this4));\n      });\n    }\n  }, {\n    key: \"drawChart\",\n    value: function drawChart() {\n      var _this5 = this;\n\n      console.log('draw pie');\n      var dataUS = this.state.category.filter(function (d) {\n        return d.Reporter == _this5.props.country && d.Product != 'AllProducts' && d.Partner == \"United-States\";\n      });\n      var dataCN = this.state.category.filter(function (d) {\n        return d.Reporter == _this5.props.country && d.Product != 'AllProducts' && d.Partner == \"China\";\n      }); //var data = this.props.category.filter(d=>d.Reporter == this.props.country && d.Product != 'AllProducts' && d.Partner == \"United-States\")\n      //console.log(data)\n\n      var margin = {\n        top: 0,\n        bottom: 0,\n        left: 0,\n        right: 0\n      },\n          width = +d3.select('#section2').style('width').slice(0, -2) * 0.35 - margin.left - margin.right,\n          height = +d3.select('#section2').style('height').slice(0, -2) * 0.35 - margin.top - margin.bottom; // var width = 300 - margin.left - margin.right;\n      // var height = 300 - margin.top - margin.bottom;\n      // Define the div for the tooltip\n\n      var div = d3.select(\"body\").append(\"div\").attr(\"class\", \"tooltip\").style(\"opacity\", 0);\n      var radius = Math.min(width, height) / 2;\n      console.log(width, height, radius); //var colorImport = d3.scaleOrdinal(['#ffffe0', '#ffd59b', '#ffa474', '#f47461', '#db4551', '#b81b34', '#8b0000']);\n\n      var colorExport = d3.scaleOrdinal([\"#f0ffff\", \"#cdeafd\", \"#acd5f9\", \"#8fbff2\", \"#75a9e6\", \"#5e94d5\", \"#4682b4\"]);\n      var pie = d3.pie() //pie generator\n      //.sort(null)\n      .sort(function (a, b) {\n        return a.value < b.value ? -1 : 1;\n      }).padAngle(0.005).value(function (d) {\n        return d['Value'];\n      });\n      var path = d3.arc().outerRadius(radius * 0.9).innerRadius(radius * 0.5);\n      var label = d3.arc().outerRadius(radius * 0.5).innerRadius(radius * 0.5);\n\n      function updateTween(d) {\n        var i = d3.interpolate(this._current, d);\n        this._current = i(0);\n        return function (t) {\n          return path(i(t));\n        };\n      }\n\n      var svg1 = d3.select('#pieUS').append('svg').attr('width', width).attr('height', height + margin.bottom).attr('id', 'pieUS-svg-svg').append('g').attr('id', 'pieUS-svg').attr('transform', 'translate(' + width / 2 + ',' + height / 2 + ')');\n      var svg2 = d3.select('#pieCN').append('svg').attr('width', width).attr('height', height + margin.bottom).attr('id', 'pieCN-svg-svg').append('g').attr('id', 'pieCN-svg').attr('transform', 'translate(' + width / 2 + ',' + height / 2 + ')');\n      d3.select('#pieUS-svg-svg').append('text').attr('x', width / 2).attr('y', height - 10).attr('id', 'ins').text('Please Select a Country').attr('font-size', '15').attr(\"text-anchor\", \"middle\");\n      /*var arc1 = svg1.selectAll('.arc')\n          //.data(pie(dataUS))\n          .enter()\n          .append('g')\n          .attr('class', 'arc')\n       var arc2 = svg2.selectAll('.arc')\n          //.data(pie(dataCN))\n          .enter()\n          .append('g')\n          .attr('class', 'arc')\n       arc1.append('path')\n          .attr('d', path)\n          .attr('fill', function (d) {\n              return colorExport(d['data'].Value)\n          })\n          .each(function(d) {\n              this._current = d;\n          })\n          .on(\"mouseover\", function (d) {\n              div.html(d['data'].Product + \": <br>\" + \"$ \" + convert(d['data'].Value))\n                  .style(\"opacity\", 1);\n          })\n          .on(\"mousemove\", function () {\n              div.style(\"left\", (d3.event.pageX + 10) + \"px\")\n                  .style(\"top\", (d3.event.pageY - 10) + \"px\")\n          })\n          .on(\"mouseout\", function () {\n              div.style(\"opacity\", 0);\n          });\n       arc2.append('path')\n          .attr('d', path)\n          .attr('fill', function (d) {\n              return colorExport(d['data'].Value)\n          })\n          .on(\"mouseover\", function (d) {\n              div.html(d['data'].Product + \": <br>\" + \"$ \" + convert(d['data'].Value))\n                  .style(\"opacity\", 1);\n          })\n          .on(\"mousemove\", function () {\n              div.style(\"left\", (d3.event.pageX + 10) + \"px\")\n                  .style(\"top\", (d3.event.pageY - 10) + \"px\")\n          })\n          .on(\"mouseout\", function () {\n              div.style(\"opacity\", 0);\n          });\n      */\n\n      var t1 = svg1.append(\"text\").attr('id', 'con-US') //.attr(\"dy\", \".35em\")\n      .attr(\"text-anchor\", \"middle\");\n      t1.append('tspan').attr('id', 'from-US').attr(\"dy\", \"-1.2em\").attr(\"x\", 0);\n      t1.append('tspan').attr('id', 'text-US').attr(\"dy\", \"1.2em\").attr(\"x\", 0);\n      t1.append('tspan').attr('id', 'total-US').attr(\"dy\", \"1.2em\").attr(\"x\", 0);\n      var t2 = svg2.append(\"text\").attr('id', 'con-CN') //.attr(\"dy\", \".35em\")\n      .attr(\"text-anchor\", \"middle\");\n      t2.append('tspan').attr('id', 'from-CN').attr(\"dy\", \"-1.2em\").attr(\"x\", 0);\n      t2.append('tspan').attr('id', 'text-CN').attr(\"dy\", \"1.2em\").attr(\"x\", 0);\n      t2.append('tspan').attr('id', 'total-CN').attr(\"dy\", \"1.2em\").attr(\"x\", 0);\n    }\n  }, {\n    key: \"upDate\",\n    value: function upDate() {\n      var _this6 = this;\n\n      //console.log(this.state.category,this.props.country)\n      console.log('update pie');\n      var totalUS = this.state.category.filter(function (d) {\n        return d.Reporter == _this6.props.country && d.Product == 'AllProducts' && d.Partner == \"United-States\";\n      })[0] ? this.convert(this.state.category.filter(function (d) {\n        return d.Reporter == _this6.props.country && d.Product == 'AllProducts' && d.Partner == \"United-States\";\n      })[0]['Value']) : 'NaN';\n      var totalCN = this.state.category.filter(function (d) {\n        return d.Reporter == _this6.props.country && d.Product == 'AllProducts' && d.Partner == \"China\";\n      })[0] ? this.convert(this.state.category.filter(function (d) {\n        return d.Reporter == _this6.props.country && d.Product == 'AllProducts' && d.Partner == \"China\";\n      })[0]['Value']) : 'NaN';\n      var dataUS = this.state.category.filter(function (d) {\n        return d.Reporter == _this6.props.country && d.Product != 'AllProducts' && d.Partner == \"United-States\";\n      });\n      var dataCN = this.state.category.filter(function (d) {\n        return d.Reporter == _this6.props.country && d.Product != 'AllProducts' && d.Partner == \"China\";\n      });\n      var margin = {\n        top: 0,\n        bottom: 0,\n        left: 0,\n        right: 0\n      },\n          width = +d3.select('#section2').style('width').slice(0, -2) * 0.35 - margin.left - margin.right,\n          height = +d3.select('#section2').style('height').slice(0, -2) * 0.35 - margin.top - margin.bottom; // var width = 250 - margin.left - margin.right;\n      // var height = 250 - margin.top - margin.bottom;\n\n      d3.select('#ins').remove();\n      var div = d3.select(\".tooltip\");\n      var radius = Math.min(width, height) / 2;\n      var colorImport = d3.scaleOrdinal(['#ffffe0', '#ffd59b', '#ffa474', '#f47461', '#db4551', '#b81b34', '#8b0000']);\n      var colorExport = d3.scaleOrdinal([\"#f0ffff\", \"#cdeafd\", \"#acd5f9\", \"#8fbff2\", \"#75a9e6\", \"#5e94d5\", \"#4682b4\"]);\n      var color = this.props.trade == 'Import' ? colorImport : colorExport;\n      var pie = d3.pie() //pie generator\n      .sort(null) //.sort(function (a, b) { return (a.value < b.value) ? -1 : 1; })\n      .padAngle(0.005).value(function (d) {\n        return d['Value'];\n      });\n      var path = d3.arc().outerRadius(radius * 0.9).innerRadius(radius * 0.5);\n      var label = d3.arc().outerRadius(radius * 0.5).innerRadius(radius * 0.5);\n\n      function arcTween(a) {\n        var i = d3.interpolate(this._current, a);\n        this._current = i(1);\n        return function (t) {\n          return path(i(t));\n        };\n      }\n      /*function exitTween (d) {\n          var end = Object.assign({}, this._current, { startAngle: this._current.endAngle });\n          var i = d3.interpolate(d, end);\n          return function(t) {\n            return path(i(t));\n          };\n      }*/\n\n\n      var svg1 = d3.select('#pieUS-svg-svg').attr('width', width).attr('height', height).select('g').attr('transform', 'translate(' + width / 2 + ',' + height / 2 + ')'); // .style('top',height*0.2)\n      // .style('left',width*0.6)\n\n      var svg2 = d3.select('#pieCN-svg-svg').attr('width', width).attr('height', height).select('g').attr('transform', 'translate(' + width / 2 + ',' + height / 2 + ')'); // .style('top',height*0.5)\n      // .style('left',width*0.6)\n\n      var arc1 = svg1.selectAll('path').data(pie(dataUS));\n      var arc2 = svg2.selectAll('path').data(pie(dataCN));\n      arc1.attr(\"d\", path).transition().duration(1000).attrTween(\"d\", arcTween).attr(\"fill\", function (d, i) {\n        return color(i);\n      });\n      arc2.attr(\"d\", path).transition().duration(1000).attrTween(\"d\", arcTween).attr(\"fill\", function (d, i) {\n        return color(i);\n      });\n      arc1.enter().append('path').attr(\"d\", path).each(function (d) {\n        this._current = d;\n      }).attr(\"fill\", function (d, i) {\n        return color(i);\n      }) //.attr(\"d\", path)\n      .on(\"mouseover\", function (d) {\n        div.html(d['data'].Product + \": <br>\" + \"$ \" + convert(d['data'].Value)).style(\"opacity\", .9).style('z-index', 10);\n      }).on(\"mousemove\", function () {\n        div.style(\"left\", d3.event.pageX + 10 + \"px\").style(\"top\", d3.event.pageY - 10 + \"px\");\n      }).on(\"mouseout\", function () {\n        div.style(\"opacity\", 0).style('z-index', -10);\n      });\n      arc2.enter().append('path').attr(\"fill\", function (d, i) {\n        return color(i);\n      }).attr(\"d\", path).each(function (d) {\n        this._current = d;\n      }).on(\"mouseover\", function (d) {\n        div.html(d['data'].Product + \": <br>\" + \"$ \" + convert(d['data'].Value)).style(\"opacity\", 1).style('z-index', 10);\n      }).on(\"mousemove\", function () {\n        div.style(\"left\", d3.event.pageX + 10 + \"px\").style(\"top\", d3.event.pageY - 10 + \"px\");\n      }).on(\"mouseout\", function () {\n        div.style(\"opacity\", 0).style('z-index', -10);\n      });\n      arc1.exit().remove();\n      arc2.exit().remove();\n      d3.select('#from-US').text('US and');\n      d3.select('#from-CN').text('CN and');\n      d3.select('#text-US').text(this.props.country);\n      d3.select('#text-CN').text(this.props.country);\n      d3.select('#total-US').text(totalUS);\n      d3.select('#total-CN').text(totalCN);\n\n      function convert(labelValue) {\n        // Nine Zeroes for Billions\n        return Math.abs(Number(labelValue)) >= 1.0e+9 ? Math.round(Math.abs(Number(labelValue)) / 1.0e+9 * 10) / 10 + \"B\" // Six Zeroes for Millions \n        : Math.abs(Number(labelValue)) >= 1.0e+6 ? Math.round(Math.abs(Number(labelValue)) / 1.0e+6 * 10) / 10 + \"M\" // Three Zeroes for Thousands\n        : Math.abs(Number(labelValue)) >= 1.0e+3 ? Math.round(Math.abs(Number(labelValue)) / 1.0e+3 * 10) / 10 + \"K\" : Math.abs(Number(labelValue));\n      }\n    }\n    /*drawCategoryChart() {\n         var margin = { top: 0, bottom: 30, left: 0, right: 0 }\n        var width = 150 - margin.left - margin.right;\n        var height = 200 - margin.top - margin.bottom;\n         var dataUS = this.state.category.filter(d => d.Reporter == this.props.country && d.Product != 'AllProducts' && d.Partner == \"United-States\")\n        var dataCN = this.state.category.filter(d => d.Reporter == this.props.country && d.Product != 'AllProducts' && d.Partner == \"China\")\n    \n        var cateData = []\n        var colorExport = d3.scaleOrdinal().domain(['United-States','China']).range([\"#2166CC\",\"#CC5343\"]);\n        var radius = Math.min(width, height) / 2\n         var pie= d3.pie()\n            .sort(function (a, b) { return (a.Country < b.Country) ? -1 : 1; })\n            .padAngle(0.005)\n            .value(function (d) { return d['Value']; });\n         var path = d3.arc()\n            .outerRadius(radius - 40)\n            .innerRadius(0);\n         var div = d3.select(\"body\").append(\"div\")\n            .attr(\"class\", \"catetooltip\")\n            .style(\"opacity\", 0);\n         for(var i=0; i<Math.max(dataUS.length, dataCN.length); i++){\n            var t = {}\n            t['data'] = []\n            if(dataUS.length > 0){\n                var temp = {}\n                t['Product'] = dataUS[i].Product\n                temp['Country'] = dataUS[i].Partner\n                temp['Value'] = dataUS[i].Value\n                t['data'].push(temp)\n            }\n            if(dataCN.length > 0){\n                var temp = {}\n                temp['Country'] = dataCN[i].Partner\n                temp['Value'] = dataCN[i].Value\n                t['data'].push(temp)\n            }\n            cateData.push(t)\n        }\n        console.log(cateData)\n         for(var i=0;i<cateData.length;i++){\n            var svg = d3.select('#category-container')\n                .append('svg')\n                .attr('width', width)\n                .attr('height', height + margin.bottom)\n                .append('g')\n                .attr('id', 'category-pie-svg'+i)\n                .attr('transform', 'translate(' + (width) / 2 + ',' + (height) / 2 + ')')\n             var arc = svg.selectAll('.arc')\n                .data(pie(cateData[i]['data']))\n                .enter()\n                .append('path')\n                .attr('d', path)\n                .attr('fill',(d)=> {\n                    return colorExport(d['data'].Country)\n                })\n                .each(function(d) {\n                    this._current = d;\n                })\n                .on(\"mouseover\", (d)=> {\n                    div.html(\"$ \" + this.convert(d['data'].Value))\n                        .style(\"opacity\", 1);\n                })\n            svg.append('text')\n                //.attr(\"dy\", \".35em\")\n                .attr(\"text-anchor\", \"middle\") // text-align: right\n                .text(cateData[i]['Product'])\n                .attr('y', 60)\n         }\n    }*/\n\n  }, {\n    key: \"convert\",\n    value: function convert(labelValue) {\n      // Nine Zeroes for Billions\n      return Math.abs(Number(labelValue)) >= 1.0e+9 ? Math.round(Math.abs(Number(labelValue)) / 1.0e+9 * 10) / 10 + \"B\" // Six Zeroes for Millions \n      : Math.abs(Number(labelValue)) >= 1.0e+6 ? Math.round(Math.abs(Number(labelValue)) / 1.0e+6 * 10) / 10 + \"M\" // Three Zeroes for Thousands\n      : Math.abs(Number(labelValue)) >= 1.0e+3 ? Math.round(Math.abs(Number(labelValue)) / 1.0e+3 * 10) / 10 + \"K\" : Math.abs(Number(labelValue));\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(\"div\", {\n        id: \"pieContainer\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 486\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        id: \"pieUS\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 487\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        id: \"pieCN\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 488\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return Pie;\n}(Component);\n\nexport { Pie as default };","map":{"version":3,"sources":["/Users/pzq317/Desktop/bacdata-web/src/PieChart.js"],"names":["React","Component","d3","categoryData","Pie","props","state","count","category","upDate","bind","drawChart","convert","nextProps","trade","year","country","setData","then","window","addEventListener","data","Promise","resolve","csv","d","Trade","Reporter","Partner","Product","Value","Year","setState","console","log","dataUS","filter","dataCN","margin","top","bottom","left","right","width","select","style","slice","height","div","append","attr","radius","Math","min","colorExport","scaleOrdinal","pie","sort","a","b","value","padAngle","path","arc","outerRadius","innerRadius","label","updateTween","i","interpolate","_current","t","svg1","svg2","text","t1","t2","totalUS","totalCN","remove","colorImport","color","arcTween","arc1","selectAll","arc2","transition","duration","attrTween","enter","each","on","html","event","pageX","pageY","exit","labelValue","abs","Number","round"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport * as d3 from 'd3'\nimport categoryData from './data/category.csv'\n\nexport default class Pie extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = {\n\t\t\tcount:0,\n            category: []\n\t\t}\n        this.upDate = this.upDate.bind(this);\n        this.drawChart = this.drawChart.bind(this);\n        //this.drawCategoryChart = this.drawCategoryChart.bind(this);\n        this.convert = this.convert.bind(this);\n\t}\n\n    shouldComponentUpdate(nextProps){\n        if(this.props.trade !== nextProps.trade || this.props.year !== nextProps.year || this.props.country !== nextProps.country){\n            return true;\n        }\n        else{\n            return false;\n        }\n    }\n    componentDidMount(){\n        this.setData().then(()=>{\n            this.drawChart()\n            //this.drawCategoryChart()\n        })\n        window.addEventListener('resize', this.upDate)\n    }\t\n\tcomponentDidUpdate() {\n        this.setData().then(()=>{\n            this.upDate()\n            //this.drawCategoryChart()\n        })\n\t}\n    setData(data) {\n        return new Promise(resolve=>{\n            d3.csv(categoryData,function(d){\n                var year = this.props.year\n                if(d.Trade == this.props.trade)\n                return {\n                    Reporter : d.Reporter,\n                    Partner : d.Partner,\n                    Product : d.Product,\n                    Trade : d.Trade,\n                    Value : +d[year],\n                    Year: year\n                }\n            }.bind(this)).then(function(category){\n                this.setState({\n                    category: category\n                })\n                resolve('ture')\n            }.bind(this))\n            \n        })\n    }\n\n\tdrawChart() {\n\n\t\tconsole.log('draw pie')\n        var dataUS = this.state.category.filter(d => d.Reporter == this.props.country && d.Product != 'AllProducts' && d.Partner == \"United-States\")\n        var dataCN = this.state.category.filter(d => d.Reporter == this.props.country && d.Product != 'AllProducts' && d.Partner == \"China\")\n        \n       \n        //var data = this.props.category.filter(d=>d.Reporter == this.props.country && d.Product != 'AllProducts' && d.Partner == \"United-States\")\n        //console.log(data)\n        var margin = { top: 0, bottom: 0, left: 0, right: 0 },\n        width = +d3.select('#section2').style('width').slice(0, -2) * 0.35 - margin.left - margin.right,\n        height = +d3.select('#section2').style('height').slice(0, -2) *0.35 - margin.top - margin.bottom;\n\n        // var width = 300 - margin.left - margin.right;\n        // var height = 300 - margin.top - margin.bottom;\n\n        // Define the div for the tooltip\n        var div = d3.select(\"body\").append(\"div\")\n            .attr(\"class\", \"tooltip\")\n            .style(\"opacity\", 0);\n        \n        var radius = Math.min(width, height) / 2\n\n        console.log(width,height,radius)\n        //var colorImport = d3.scaleOrdinal(['#ffffe0', '#ffd59b', '#ffa474', '#f47461', '#db4551', '#b81b34', '#8b0000']);\n        var colorExport = d3.scaleOrdinal([\"#f0ffff\",\"#cdeafd\",\"#acd5f9\",\"#8fbff2\",\"#75a9e6\",\"#5e94d5\",\"#4682b4\"]);\n\n        var pie= d3.pie() //pie generator\n            //.sort(null)\n            .sort(function (a, b) { return (a.value < b.value) ? -1 : 1; })\n            .padAngle(0.005)\n            .value(function (d) { return d['Value']; });\n\n        var path = d3.arc()\n            .outerRadius(radius*0.9)\n            .innerRadius(radius*0.5);\n\n        var label = d3.arc()\n            .outerRadius(radius*0.5)\n            .innerRadius(radius*0.5)\n\n        function updateTween (d) {\n            var i = d3.interpolate(this._current, d);\n            this._current = i(0);\n            return function(t) {\n              return path(i(t));\n            };\n        }\n\n        var svg1 = d3.select('#pieUS')\n            .append('svg')\n            .attr('width', width)\n            .attr('height', height + margin.bottom)\n            .attr('id', 'pieUS-svg-svg')\n            .append('g')\n            .attr('id', 'pieUS-svg')\n            .attr('transform', 'translate(' + (width) / 2 + ',' + (height) / 2 + ')')\n\n        var svg2 = d3.select('#pieCN')\n            .append('svg')\n            .attr('width', width)\n            .attr('height', height + margin.bottom)\n            .attr('id', 'pieCN-svg-svg')\n            .append('g')\n            .attr('id', 'pieCN-svg')\n            .attr('transform', 'translate(' + (width) / 2 + ',' + (height) / 2 + ')')\n\n        d3.select('#pieUS-svg-svg').append('text')\n            .attr('x', width/2)\n            .attr('y', height -10)\n            .attr('id','ins')\n            .text('Please Select a Country')\n            .attr('font-size','15')\n            .attr(\"text-anchor\", \"middle\")\n            \n\n        /*var arc1 = svg1.selectAll('.arc')\n            //.data(pie(dataUS))\n            .enter()\n            .append('g')\n            .attr('class', 'arc')\n\n        var arc2 = svg2.selectAll('.arc')\n            //.data(pie(dataCN))\n            .enter()\n            .append('g')\n            .attr('class', 'arc')\n\n        arc1.append('path')\n            .attr('d', path)\n            .attr('fill', function (d) {\n                return colorExport(d['data'].Value)\n            })\n            .each(function(d) {\n                this._current = d;\n            })\n            .on(\"mouseover\", function (d) {\n                div.html(d['data'].Product + \": <br>\" + \"$ \" + convert(d['data'].Value))\n                    .style(\"opacity\", 1);\n            })\n            .on(\"mousemove\", function () {\n                div.style(\"left\", (d3.event.pageX + 10) + \"px\")\n                    .style(\"top\", (d3.event.pageY - 10) + \"px\")\n            })\n            .on(\"mouseout\", function () {\n                div.style(\"opacity\", 0);\n            });\n\n        arc2.append('path')\n            .attr('d', path)\n            .attr('fill', function (d) {\n                return colorExport(d['data'].Value)\n            })\n            .on(\"mouseover\", function (d) {\n                div.html(d['data'].Product + \": <br>\" + \"$ \" + convert(d['data'].Value))\n                    .style(\"opacity\", 1);\n            })\n            .on(\"mousemove\", function () {\n                div.style(\"left\", (d3.event.pageX + 10) + \"px\")\n                    .style(\"top\", (d3.event.pageY - 10) + \"px\")\n            })\n            .on(\"mouseout\", function () {\n                div.style(\"opacity\", 0);\n            });\n        */\n        var t1 = svg1.append(\"text\")\n            .attr('id','con-US')\n            //.attr(\"dy\", \".35em\")\n            .attr(\"text-anchor\", \"middle\")\n        t1.append('tspan')\n            .attr('id','from-US')\n            .attr(\"dy\", \"-1.2em\")\n            .attr(\"x\", 0)\n            \n\n        t1.append('tspan')\n            .attr('id','text-US')\n            .attr(\"dy\", \"1.2em\")\n            .attr(\"x\", 0)\n            \n\n        t1.append('tspan')\n            .attr('id','total-US')\n            .attr(\"dy\", \"1.2em\")\n            .attr(\"x\", 0)\n            \n\n             \n        var t2 = svg2.append(\"text\")\n            .attr('id','con-CN')\n            //.attr(\"dy\", \".35em\")\n            .attr(\"text-anchor\", \"middle\") \n\n        t2.append('tspan')\n            .attr('id','from-CN')\n            .attr(\"dy\", \"-1.2em\")\n            .attr(\"x\", 0)\n\n        t2.append('tspan')\n            .attr('id','text-CN')\n            .attr(\"dy\", \"1.2em\")\n            .attr(\"x\", 0)\n\n        t2.append('tspan')\n            .attr('id','total-CN')\n            .attr(\"dy\", \"1.2em\")\n            .attr(\"x\", 0)\n\n        \n\t}\n\n\tupDate() {\n        //console.log(this.state.category,this.props.country)\n        console.log('update pie')\n        var totalUS = this.state.category.filter(d => d.Reporter == this.props.country && d.Product == 'AllProducts' && d.Partner == \"United-States\")[0] ? this.convert(this.state.category.filter(d => d.Reporter == this.props.country && d.Product == 'AllProducts' && d.Partner == \"United-States\")[0]['Value']):'NaN'\n        var totalCN = this.state.category.filter(d => d.Reporter == this.props.country && d.Product == 'AllProducts' && d.Partner == \"China\")[0] ? this.convert(this.state.category.filter(d => d.Reporter == this.props.country && d.Product == 'AllProducts' && d.Partner == \"China\")[0]['Value']):'NaN'\n\n        var dataUS = this.state.category.filter(d => d.Reporter == this.props.country && d.Product != 'AllProducts' && d.Partner == \"United-States\")\n        var dataCN = this.state.category.filter(d => d.Reporter == this.props.country && d.Product != 'AllProducts' && d.Partner == \"China\")\n        var margin = { top: 0, bottom: 0, left: 0, right: 0 },\n            width = +d3.select('#section2').style('width').slice(0, -2) * 0.35 - margin.left - margin.right,\n            height = +d3.select('#section2').style('height').slice(0, -2) *0.35 - margin.top - margin.bottom;\n\n        // var width = 250 - margin.left - margin.right;\n        // var height = 250 - margin.top - margin.bottom;\n        d3.select('#ins').remove()\n        var div = d3.select(\".tooltip\")\n\n\n        var radius = Math.min(width, height) / 2\n        var colorImport = d3.scaleOrdinal(['#ffffe0', '#ffd59b', '#ffa474', '#f47461', '#db4551', '#b81b34', '#8b0000']);\n        var colorExport = d3.scaleOrdinal([\"#f0ffff\",\"#cdeafd\",\"#acd5f9\",\"#8fbff2\",\"#75a9e6\",\"#5e94d5\",\"#4682b4\"]);\n\n        var color = this.props.trade == 'Import'? colorImport : colorExport\n        var pie= d3.pie() //pie generator\n            .sort(null)\n            //.sort(function (a, b) { return (a.value < b.value) ? -1 : 1; })\n            .padAngle(0.005)\n            .value(function (d) { return d['Value']; });\n\n        var path = d3.arc()\n            .outerRadius(radius*0.9)\n            .innerRadius(radius*0.5);\n\n        var label = d3.arc()\n            .outerRadius(radius*0.5)\n            .innerRadius(radius*0.5)\n\n        function arcTween(a) {\n            const i = d3.interpolate(this._current, a);\n            this._current = i(1);\n            return (t) => path(i(t));\n        }\n\n        /*function exitTween (d) {\n            var end = Object.assign({}, this._current, { startAngle: this._current.endAngle });\n            var i = d3.interpolate(d, end);\n            return function(t) {\n              return path(i(t));\n            };\n        }*/\n\n        var svg1 = d3.select('#pieUS-svg-svg')\n                    .attr('width', width)\n                    .attr('height', height)\n                    .select('g')\n                    .attr('transform', 'translate(' + (width) / 2 + ',' + (height) / 2 + ')')\n                    // .style('top',height*0.2)\n                    // .style('left',width*0.6)\n\n\n        var svg2 = d3.select('#pieCN-svg-svg')\n                    .attr('width', width)\n                    .attr('height', height)\n                    .select('g')\n                    .attr('transform', 'translate(' + (width) / 2 + ',' + (height) / 2 + ')')\n                    // .style('top',height*0.5)\n                    // .style('left',width*0.6)\n\n            \n        var arc1 = svg1.selectAll('path').data(pie(dataUS))\n        var arc2 = svg2.selectAll('path').data(pie(dataCN))\n\n        arc1.attr(\"d\", path)\n            .transition().duration(1000).attrTween(\"d\", arcTween)\n            .attr(\"fill\", function(d, i) { return color(i); })\n            \n\n        arc2.attr(\"d\", path)\n            .transition().duration(1000).attrTween(\"d\", arcTween)\n            .attr(\"fill\", function(d, i) { return color(i); })\n\n        arc1.enter()\n            .append('path')\n            .attr(\"d\", path)\n            .each(function(d) { this._current = d; })\n            .attr(\"fill\", function(d, i) { return color(i); })\n            //.attr(\"d\", path)\n            .on(\"mouseover\", function (d) {\n                div.html(d['data'].Product + \": <br>\" + \"$ \" + convert(d['data'].Value))\n                    .style(\"opacity\", .9)\n                    .style('z-index',10)\n            })\n            .on(\"mousemove\", function () {\n                div.style(\"left\", (d3.event.pageX + 10) + \"px\")\n                    .style(\"top\", (d3.event.pageY - 10) + \"px\")\n            })\n            .on(\"mouseout\", function () {\n                div.style(\"opacity\", 0)\n                    .style('z-index',-10)\n            });\n\n        arc2.enter()\n            .append('path')\n            .attr(\"fill\", function(d, i) { return color(i); })\n            .attr(\"d\", path)\n            .each(function(d) {this._current = d;})\n            .on(\"mouseover\", function(d) {\n                div.html(d['data'].Product + \": <br>\" + \"$ \" + convert(d['data'].Value))\n                    .style(\"opacity\", 1)\n                    .style('z-index',10)\n            })\n            .on(\"mousemove\", function () {\n                div.style(\"left\", (d3.event.pageX + 10) + \"px\")\n                    .style(\"top\", (d3.event.pageY - 10) + \"px\")\n            })\n            .on(\"mouseout\", function () {\n                div.style(\"opacity\", 0)\n                    .style('z-index',-10)\n            });\n        \n        arc1.exit()\n            .remove()\n\n        arc2.exit()\n            .remove()\n\n        d3.select('#from-US').text('US and')\n        d3.select('#from-CN').text('CN and')\n        d3.select('#text-US').text(this.props.country)\n        d3.select('#text-CN').text(this.props.country)\n        d3.select('#total-US').text(totalUS)\n        d3.select('#total-CN').text(totalCN)\n        function convert(labelValue) {\n\n            // Nine Zeroes for Billions\n            return Math.abs(Number(labelValue)) >= 1.0e+9\n    \n            ? Math.round((Math.abs(Number(labelValue)) / 1.0e+9)*10)/10 + \"B\"\n            // Six Zeroes for Millions \n            : Math.abs(Number(labelValue)) >= 1.0e+6\n    \n            ? Math.round((Math.abs(Number(labelValue)) / 1.0e+6)*10)/10 + \"M\"\n            // Three Zeroes for Thousands\n            : Math.abs(Number(labelValue)) >= 1.0e+3\n    \n            ? Math.round((Math.abs(Number(labelValue)) / 1.0e+3)*10)/10 + \"K\"\n    \n            : Math.abs(Number(labelValue));\n    \n        }\n\t}\n    /*drawCategoryChart() {\n\n        var margin = { top: 0, bottom: 30, left: 0, right: 0 }\n        var width = 150 - margin.left - margin.right;\n        var height = 200 - margin.top - margin.bottom;\n\n        var dataUS = this.state.category.filter(d => d.Reporter == this.props.country && d.Product != 'AllProducts' && d.Partner == \"United-States\")\n        var dataCN = this.state.category.filter(d => d.Reporter == this.props.country && d.Product != 'AllProducts' && d.Partner == \"China\")\n    \n        var cateData = []\n        var colorExport = d3.scaleOrdinal().domain(['United-States','China']).range([\"#2166CC\",\"#CC5343\"]);\n        var radius = Math.min(width, height) / 2\n\n        var pie= d3.pie()\n            .sort(function (a, b) { return (a.Country < b.Country) ? -1 : 1; })\n            .padAngle(0.005)\n            .value(function (d) { return d['Value']; });\n\n        var path = d3.arc()\n            .outerRadius(radius - 40)\n            .innerRadius(0);\n\n        var div = d3.select(\"body\").append(\"div\")\n            .attr(\"class\", \"catetooltip\")\n            .style(\"opacity\", 0);\n\n        for(var i=0; i<Math.max(dataUS.length, dataCN.length); i++){\n            var t = {}\n            t['data'] = []\n            if(dataUS.length > 0){\n                var temp = {}\n                t['Product'] = dataUS[i].Product\n                temp['Country'] = dataUS[i].Partner\n                temp['Value'] = dataUS[i].Value\n                t['data'].push(temp)\n            }\n            if(dataCN.length > 0){\n                var temp = {}\n                temp['Country'] = dataCN[i].Partner\n                temp['Value'] = dataCN[i].Value\n                t['data'].push(temp)\n            }\n            cateData.push(t)\n        }\n        console.log(cateData)\n\n        for(var i=0;i<cateData.length;i++){\n            var svg = d3.select('#category-container')\n                .append('svg')\n                .attr('width', width)\n                .attr('height', height + margin.bottom)\n                .append('g')\n                .attr('id', 'category-pie-svg'+i)\n                .attr('transform', 'translate(' + (width) / 2 + ',' + (height) / 2 + ')')\n\n            var arc = svg.selectAll('.arc')\n                .data(pie(cateData[i]['data']))\n                .enter()\n                .append('path')\n                .attr('d', path)\n                .attr('fill',(d)=> {\n                    return colorExport(d['data'].Country)\n                })\n                .each(function(d) {\n                    this._current = d;\n                })\n                .on(\"mouseover\", (d)=> {\n                    div.html(\"$ \" + this.convert(d['data'].Value))\n                        .style(\"opacity\", 1);\n                })\n            svg.append('text')\n                //.attr(\"dy\", \".35em\")\n                .attr(\"text-anchor\", \"middle\") // text-align: right\n                .text(cateData[i]['Product'])\n                .attr('y', 60)\n\n        }\n    }*/\n    convert(labelValue) {\n        // Nine Zeroes for Billions\n        return Math.abs(Number(labelValue)) >= 1.0e+9\n\n        ? Math.round((Math.abs(Number(labelValue)) / 1.0e+9)*10)/10 + \"B\"\n        // Six Zeroes for Millions \n        : Math.abs(Number(labelValue)) >= 1.0e+6\n\n        ? Math.round((Math.abs(Number(labelValue)) / 1.0e+6)*10)/10 + \"M\"\n        // Three Zeroes for Thousands\n        : Math.abs(Number(labelValue)) >= 1.0e+3\n\n        ? Math.round((Math.abs(Number(labelValue)) / 1.0e+3)*10)/10 + \"K\"\n\n        : Math.abs(Number(labelValue));\n\n    }\n\n\n    \n\n\n\trender() {\n\t\treturn (\n            <div id='pieContainer'>\n    \t\t\t<div id='pieUS'></div>\n                <div id='pieCN'></div>\n                {/*<div id='category-container'></div>*/}\n            </div>\n\t\t)\n\t}\n\n}"]},"metadata":{},"sourceType":"module"}